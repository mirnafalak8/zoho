{% extends 'base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.3/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
  .custom-height {
    height: 40px;
  }

  .list-item {
    cursor: pointer;
  }

  .vertical-separator {
    border-right: 1px solid #ddd;
  }

  .list-item:hover {
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 5px;
  }

  .list-item:hover {
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 5px;
    text-decoration: none;
  }

  .custom-item:hover {
    color: white;
  }

  section {
    background-color: #202325;
    /* padding-top: 20px;
    padding-left: 20px; */
    padding: 20px 0 20px 10px;
    border-radius: 10px;
  }
  footer {
    margin-top: 40px;
    width: 100%;
    height: auto;
    padding: 20px;
  }
  .text-center {
    display: flex;
    justify-content: space-between;
  }

  .left-section {
    text-align: left;
  }

  .right-section {
    text-align: right;
  }
  
</style>
<section>
  <div class="row" style="top: 7rem;">
    <div class="col-md-5">
      <div class="search-bar">
        <form action="{% url 'journal_list' %}" method="GET" class="input-group">
          <input type="text" name="query" placeholder="Search..." class="form-control custom-height text-dark">
        </form>
      </div>
    </div>
  </div>
  <br>
  <div class="container-fluid mt-5">
    <div class="row">
      <div class="col-md-5 vertical-separator">
        <div class="d-flex justify-content-between align-items-center">
          <h3 class="mb text-white">Manual Journal</h3>
          <a href="{% url 'add_journal' %}" class="btn btn-dark border-primary custom-height btn-center"
            style="width: 80px;color: #F86F03;">+ NEW</a>
          <div class="dropdown">
            <button class="btn btn-dark border-primary custom-height" style="width: 70px;color: #F86F03;" type="button"
              id="filterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fa fa-filter"></i>
            </button>
            <ul class="dropdown-menu bg-dark" aria-labelledby="filterDropdown">
              <li><a class="dropdown-item custom-item text-light" href="{% url 'journal_list' %}">All</a></li>
              <li><a class="dropdown-item custom-item text-light" href="{% url 'journal_list' %}?filter=draft">Draft</a>
              </li>
              <li><a class="dropdown-item custom-item text-light"
                  href="{% url 'journal_list' %}?filter=published">Published</a></li>
            </ul>
          </div>
        </div>

        <div class="list-group mt-3">
          {% for journal in journals %}
          <a href="#" class="list-item" data-journal-id="{{ journal.id }}">
            <div class="d-flex justify-content-between text-white">
              <span>{{ journal.date }}</span>
              <span><i class="fa fa-inr"></i>{{ journal.total_debit }}</span>
            </div>
            <div class="d-flex justify-content-between text-white mt-2">
              <span>{{ journal.journal_no }}</span>
              {% if journal.status == 'draft' %}
              <span class="status draft" style="color: orangered;">{{ journal.status }}</span>
              {% elif journal.status == 'published' %}
              <span class="status published text-success">{{ journal.status }}</span>
              {% else %}
              <span class="status">{{ journal.status }}</span>
              {% endif %}
            </div>
          </a>
          {% endfor %}
        </div>
      </div>
      <div class="col-md-7">
        <div class="d-flex justify-content-between align-items-center">
          <button class="btn btn-success">Publish</button>
          <button class="btn btn-primary btn-overview">Overview</button>
          <button class="btn btn-primary">Template</button>
          <button class="btn btn-primary"><i class="fa fa-comments" aria-hidden="true"></i>
            <button class="btn btn-primary"><i class="fa fa-edit" aria-hidden="true"></i></button>
            <button class="btn btn-primary"><i class="fa fa-file-pdf" aria-hidden="true"></i></button>
            <button class="btn btn-primary"><i class="fa fa-print" aria-hidden="true"></i></button>
            <button class="btn btn-primary"><i class="fa fa-file" aria-hidden="true"></i></button>
            <button class="btn btn-danger"><i class="fa fa-trash" aria-hidden="true"></i></button>
        </div>
        <!-- Content -->
        <div class="details-section mt-4">
          <!-- Your content for the right section goes here -->
          <div class="overview-section" style="display: none;">
            <!-- Content for the overview section (populated when "Overview" button is clicked) -->
            <!-- The content will be loaded dynamically using JavaScript when the button is clicked. -->
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<script>
  // jQuery script to handle click event and load journal details
  $(document).ready(function () {
    $('.list-item').click(function (event) {
      event.preventDefault();
      const journalId = $(this).data('journal-id');
      const detailsSection = $('.details-section');

      // Fetch journal and journal entries details using AJAX
      $.ajax({
        url: `/get_journal_details/${journalId}/`, // Replace with your Django URL
        method: 'GET',
        dataType: 'json',
        success: function (data) {
          // Clear the details-section first
          detailsSection.empty();

          // Display the journal details
          detailsSection.append(`
                      <div class="container-fluid bg-white text-dark">
                          <br><br>
                          <div class="row justify-content-center">
                              <div class="col-md-9">
                                  <h2 class="left-align">${data.company_name}</h2>
                                  <p class="left-align">${data.address}</p>
                                  <hr>
                                  <div class="text-center">
                                      <div class="left-section">
                                          <p>Notes:</p>
                                          <p>${data.selected_journal.notes}</p>
                                          <p>Reference No: ${data.selected_journal.reference_no}</p>
                                      </div>
                                      <div class="right-section">
                                          <p>Journal No: ${data.selected_journal.journal_no}</p>
                                          <p>Date: ${data.selected_journal.date}</p>
                                          <p>Amount: <i class="fa fa-inr"></i>${data.selected_journal.total_credit}</p>
                                      </div>
                                  </div>
                                  <hr>
                                  <div class="table-responsive">
                                      <table class="table">
                                          <thead>
                                              <tr>
                                                  <th>Account Name</th>
                                                  <th>Description</th>
                                                  <th>Contact</th>
                                                  <th>Debits</th>
                                                  <th>Credits</th>
                                              </tr>
                                          </thead>
                                          <tbody>
                                              ${data.journal_entries.map(entry => `
                                                  <tr>
                                                      <td>${entry.account}</td>
                                                      <td>${entry.description}</td>
                                                      <td>${entry.contact}</td>
                                                      <td>${entry.debits}</td>
                                                      <td>${entry.credits}</td>
                                                  </tr>
                                              `).join('')}
                                          </tbody>
                                      </table>
                                  </div>
                                  <div class="text-center">
                                      <table class="table">
                                          <tbody>
                                              <tr>
                                                  <td>Total Debit:</td>
                                                  <td><i class="fa fa-inr"></i>${data.selected_journal.total_debit}</td>
                                              </tr>
                                              <tr>
                                                  <td>Total Credit:</td>
                                                  <td><i class="fa fa-inr"></i>${data.selected_journal.total_credit}</td>
                                              </tr>
                                              <tr>
                                                  <td>Difference:</td>
                                                  <td>${data.selected_journal.difference}</td>
                                              </tr>
                                          </tbody>
                                      </table>
                                  </div>
                              </div>
                          </div>
                          <footer>
                          <h5 class="text-center" style="font-size: 12px;">
                            © Zoho Books 2023 | Info park kakkanad kochi, Ernamkulam, kerala India 12345 |
                            Phone: (123) 456-7890 | Email: info@zohodjango.com
                          </h5>
                        </footer>
                      </div>
                      <br><br>
                  `);
        },
        error: function (error) {
          console.error('Error fetching journal details:', error);
        }
      });
    });
    $('.btn-overview').click(function () {
      // Show the overview section and hide the journal details section
      $('.overview-section').show();
      const overviewTemplate = `
        <div class="container-fluid bg-light text-dark">
          <br><br>
  <div class="row justify-content-center">
    <div class="col-md-9">
      <h2 class="left-align text-primary">${data.company_name}</h2>
      <p class="left-align text-secondary">${data.address}</p>
      <hr class="bg-primary">
      <div class="text-center">
        <div class="row">
          <div class="col-md-6">
            <div class="card bg-info text-white">
              <div class="card-body">
                <p><strong>Notes:</strong></p>
                <p>${data.selected_journal.notes}</p>
                <p><strong>Reference No:</strong> ${data.selected_journal.reference_no}</p>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card bg-info text-white">
              <div class="card-body">
                <p><strong>Journal No:</strong> ${data.selected_journal.journal_no}</p>
                <p><strong>Date:</strong> ${data.selected_journal.date}</p>
                <p><strong>Amount:</strong> <i class="fa fa-inr"></i>${data.selected_journal.total_credit}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <hr class="bg-primary">
      <div class="row">
        <div class="col-md-12">
          <h4 class="text-primary">Journal Entries</h4>
          ${data.journal_entries.map(entry => `
            <div class="entry card bg-primary text-white">
              <div class="card-body">
                <p><strong>Account Name:</strong> ${entry.account}</p>
                <p><strong>Description:</strong> ${entry.description}</p>
                <p><strong>Contact:</strong> ${entry.contact}</p>
                <p><strong>Debits:</strong> ${entry.debits}</p>
                <p><strong>Credits:</strong> ${entry.credits}</p>
              </div>
            </div>
          `).join('')}
        </div>
      </div>
      <div class="text-center">
        <hr class="bg-primary">
        <p class="text-success"><strong>Total Debit:</strong> <i class="fa fa-inr"></i>${data.selected_journal.total_debit}</p>
        <p class="text-success"><strong>Total Credit:</strong> <i class="fa fa-inr"></i>${data.selected_journal.total_credit}</p>
        <p class="text-success"><strong>Difference:</strong> ${data.selected_journal.difference}</p>
      </div>
    </div>
  </div>
  <footer>
    <h5 class="text-center text-muted" style="font-size: 12px;">
      © Zoho Books 2023 | Info park kakkanad kochi, Ernamkulam, kerala India 12345 |
      Phone: (123) 456-7890 | Email: info@zohodjango.com
    </h5>
  </footer>
  </div>
      `;

      // Insert the overview content into the overview section
      $('.overview-section').html(overviewTemplate);
    });
  });
</script>
{% endblock %}