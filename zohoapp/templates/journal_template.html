{% extends 'base.html' %}
{% load static %}

{% block content %}
  <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.3/jspdf.umd.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <section style="height: 150vh; overflow: auto;">
    <div class="container-fluid bg-white text-dark">
      <br><br>
      <div class="row justify-content-center">
        <div class="col-md-6">
          <h2 class="text-center">ALTOS Technologies</h2>
          <p class="text-center">Kochi, Kerala</p>
          <hr>
          <div class="row">
            <div class="col-md-6">
              <p class="text-center">Notes:</p>
              <p class="text-center">{{ journal.notes }}</p>
            </div>
            <div class="col-md-6">
              <p>Journal No: {{ journal.journal_no }}</p>
              <p>Date: {{ journal.date }}</p>
              <p>Amount: <i class="fa fa-inr"></i>{{ journal.total_credit }}</p>
              <p>Reference No: {{ journal.reference_no }}</p>
            </div>
          </div>
          <hr>
          <div id="content" class="text-center">  
              <!-- <ul>
                  {% for entry in journal_entries %}
                      <li>Account name: {{ entry.account }} - Description: {{ entry.description }} Contact: {{ entry.contact }},
                          Debits: {{ entry.debits }}, Credits: {{ entry.credits }}</li>
                  {% endfor %}
              </ul> -->
              <p class="text-left">Status: <span id="status">{{ journal.status }}</span></p>
              <p>Total Debit: <i class="fa fa-inr"></i>{{ journal.total_debit }}</p>
              <p>Total Credit: <i class="fa fa-inr"></i>{{ journal.total_credit }}</p>
              <p>Difference: {{ journal.difference }}</p>
              <div class="text-center">
                <a href="{% url 'edit_journal' journal.id %}" class="btn btn-primary">Edit</a>
                <button onclick="generatePDF()" class="btn btn-success">Download PDF</button>
                <a href="{% url 'delete_journal' journal.id %}"><button onclick="confirmDelete()"  class="btn btn-danger">Delete</button></a>
              </div>
          </div>
        </div>
      </div>

      <!-- <div class="row justify-content-center">
        <div class="col-md-6">
          <div class="text-center">
            <a href="{% url 'edit_journal' journal.id %}" class="btn btn-primary">Edit</a>
            <button onclick="generatePDF()" class="btn btn-success">Download PDF</button>
            <button onclick="confirmDelete()" class="btn btn-danger">Delete</button>
          </div>
        </div>
      </div> -->
      <br><br>
    </div>
  </section>

  <script>
    function generatePDF() {
      const doc = new jsPDF({
        orientation: 'portrait',
        unit: 'mm',
        format: 'a4',
      });

      const content = document.getElementById('content');
      const contentHeight = content.offsetHeight;
      const pageHeight = doc.internal.pageSize.height;

      let position = 15;
      let page = 1;

      while (position < contentHeight) {
        doc.addPage();
        doc.text(15, 15, `Page ${page}`);
        doc.fromHTML(content.innerHTML, 15, position, {
          width: 180, 
        });

        position += pageHeight - 30;
        page++;
      }

      const pdfData = doc.output('blob');
      const blobUrl = URL.createObjectURL(pdfData);

      const newTab = window.open();
      newTab.location.href = blobUrl;
    }
    
    function confirmDelete() {
      if (confirm("Are you sure you want to delete this journal?")) {
        alert("Journal deleted successfully!");
      }
    }
  </script>
{% endblock %}
