{% extends 'base.html' %}
{% load static %}
{% block content %}
<style>
    .table-container {
        height: 600px;
        margin-left:90px;
    }
    .button-container {
       width: 100px;
        margin-left: 540px;
        background-color: rgb(230, 171, 45);
    }
    .form-control{
      background-color: black transparent;
    }
    .button-container a{
        color: #FFFEEE;
    }
    td a{
        color: rgb(230, 171, 45);
    }
    #over:hover{
        background-color: rgba(110, 110, 110, 0.616);
        
    }
    td {
    white-space: nowrap; /* Prevent content from wrapping */
    /* Add any additional styles or width as needed */
    color: #FFFEEE;
  }
  tr{
    color: #fff;
  }
  
</style>

<h1>Payment Made</h1>




<div class="container" style="margin-top: 50px;">
<div class="row">
    <div class="col-md-3">
    <div class="search-bar">
        <div class="row">
            <div class="col-md-3">
                <input type="search" id="searchInput"  placeholder="Search Payment Made.." style="width: 500px;" class="form-control  bg-dark">

            </div>
            <div class="col-md-9">
                
            </div>
        </div>
        
            
        
    </div>
</div>
<div class="col-md-9">
    <div class="button-container">
        <a type="button" class="btn  ml-auto" style="width: 100px;" href="{% url 'paymentadd_method' %}">+new</a>
    </div>
</div>
</div>
    <div class="table-responsive">
    <table id="vendorTable" class="table" style="width:100%;  margin-top: 20px;">
        <thead>
            <tr>
                <th class="text-white">#</th>
                <th class="text-white">Vendor</th>
                <th class="text-white">Reference</th>
                <th class="text-white">Payment Date</th>
                <th class="text-white">Payment-Method</th>
                <th class="text-white">Paid Through</th>
                <th class="text-white">Ammount Received</th>



            </tr>
        </thead>
        <tbody>
            {% for p in paymnt %}
                                <tr id="over">
                                    <td style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px;">{{ p.id}}</td>
                                    <td><a href="{% url 'payment_details_view' p.id %}">{{ p.vendor.first_name}}</a></td>
                                    <td>{{ p.reference }}</td>
                                    <td>{{ p.date }}</td>
                                    <td>{{ p.payment }}</td>  
                                    <td>{{ p.cash.bnk_name }}</td>  
                                    <td>â‚¹{{ p.amount }}</td> 
                                    </tr>
                                    {% endfor %}

            </tbody>
            </table>
        </div>
        </div>

<script>

  const searchInput = document.getElementById("searchInput");
  const vendorTable = document.getElementById("vendorTable").getElementsByTagName('tbody')[0].getElementsByTagName('tr');

  searchInput.addEventListener("input", function () {
    const searchTerm = this.value.toLowerCase();

    for (let i = 0; i < vendorTable.length; i++) {
      const rowData = vendorTable[i].getElementsByTagName("td");
      let rowVisible = false;

      for (let j = 0; j < rowData.length; j++) {
        if (rowData[j].textContent.toLowerCase().includes(searchTerm)) {
          rowVisible = true;
          break;
        }
      }

      vendorTable[i].style.display = rowVisible ? "" : "none";
    }
  });

    </script>

{% endblock %}

<!-- <script>
  $(document).ready(function() {
       $('.btn-info').prop('disabled', true);
 
       $('.list-item').click(function() {
         $('.list-item').removeClass('active');
         $(this).addClass('active');
 
         $('.btn-info').prop('disabled', false);
         $('.template-button').show();
 
         // var journalId = $(this).data('journal-id');
         var journalDetailsContent = $(this).data('journal-details');
       $('.details-section').html(journalDetailsContent);
       });
 
       // var journalId = $(this).data('journal-id');
       // var journalDetailsUrl = $(this).data('journal-details-url');
       // $('.details-section').html('<p>Loading journal details...</p>');
       // $.ajax({
       //   url: "{% url 'journal_details' %}",
       //   method: 'GET',
       //   data: {
       //     journal_id: journalId
       //   },
       //   success: function(response) {
       //     $('.details-section').html(response);
       //     loadJournalComments(journalId);
       //     $('.template-button').show();
       //   },
       //   error: function() {
       //     $('.details-section').html('<p>Failed to load journal details.</p>');
         // }
       
     
 
     $('.btn-publish').click(function() {
       var journalId = $('.list-item.active').data('journal-id');
       var publishUrl = "{% url 'publish_journal' %}";
       var csrfToken = "{{ csrf_token }}";
       $.ajax({
         url: publishUrl,
         method: 'POST',
         headers: {
           "X-CSRFToken": csrfToken
         },
         data: {
           journal_id: journalId,
         },
         success: function(response) {
           $('.details-section .status').text('Published');
 
           $('.list-item.active .status').text('Published');
         },
         error: function() {
           console.log('Failed to publish journal.');
         }
       });
     });
 
     $('.template-button').click(function() {
       var selectedJournalId = $('.list-item.active').data('journal-id');
       var journalDetailsUrl = "{% url 'journal_details' %}?journal_id=" + selectedJournalId;
       window.location.href = journalDetailsUrl;
     });
 
     function loadJournalComments(journalId) {
       var commentsUrl = "{% url 'journal_comments' %}";
 
       $.ajax({
         url: commentsUrl,
         method: 'GET',
         data: {
           journal_id: journalId
         },
         success: function(response) {
           var comments = response.comments;
           var commentsContainer = $('#commentsContainer');
           commentsContainer.empty();
 
           for (var i = 0; i < comments.length; i++) {
             var comment = comments[i];
             var commentHTML = '<div class="comment"><p>' + comment.text + '</p><p class="text-muted">Date: <span>' + comment.date_time + '</span></p></div>';
             commentsContainer.append(commentHTML);
           }
         },
         error: function() {
           console.log('Failed to load journal comments.');
         }
       });
     }
 
     $('#commentForm').submit(function(event) {
       event.preventDefault();
 
       var comment = $('#commentInput').val();
 
       saveJournalComment(comment);
 
       $('#commentInput').val('');
     });
 
     function saveJournalComment(comment) {
       var journalId = $('.list-item.active').data('journal-id');
       var commentsUrl = "{% url 'journal_comments' %}";
 
       $.ajax({
         url: commentsUrl,
         method: 'POST',
         data: {
           journal_id: journalId,
           comment: comment,
           csrfmiddlewaretoken: '{{ csrf_token }}'
         },
         success: function(response) {
           var comment = response.comment;
           var commentHTML = '<div class="comment">' +
             '<div class="comment-text">' + comment.text + '</div>' +
             '<div class="comment-date">' + comment.date_time + '</div>' +
             '</div>';
           $('#commentsContainer').prepend(commentHTML);
         },
         error: function() {
           console.log('Failed to save journal comment.');
         }
       });
     }
 
     $('#myModal').on('hidden.bs.modal', function() {
       var journalId = $('.list-item.active').data('journal-id');
       loadJournalDetails(journalId);
     });
     function getJournalDetailsContent(journalId) {
         // Your logic to fetch journal details here (if needed)
         // For demonstration purposes, I'll just create a sample content
         var journalDetailsContent = `
         <section>
         <div class="text-end bg-white p-4">
           <a href="#" class="btn btn-primary">
             <i class="fa fa-pencil"></i>
           </a>
           <a onclick="convertToPDF()" class="btn btn-primary">
             <i class="fa fa-file-pdf-o" style="color: aliceblue;"></i>
           </a>
           <a onclick="printJournal()" class="btn btn-primary">
             <i class="fa fa-print"></i>
           </a>
           <!-- <button onclick="viewPDF()" class="btn btn-info">View PDF</button> -->
           {% if journal.attachment %}
           <div class="btn-group" role="group">
             <a href="{{ journal.attachment.url }}" class="btn btn-primary" download data-toggle="tooltip" data-placement="bottom">
               <i class="fa fa-paperclip" style="color: aliceblue;"></i>
             </a>
             <button type="button" class="btn btn-primary" data-toggle="tooltip" data-placement="bottom" disabled>
               {{ journal.attachment.name }}
             </button>
           </div>
           {% endif %}
           <a href="" onclick="return confirmDelete()">
             <button class="btn btn-danger">
               <i class="fa fa-trash"></i>
             </button>
           </a>
         </div>
       <div class="container-fluid bg-white text-dark" id="container">
         <br><br>
         <div class="row justify-content-center">
           <div class="col-md-9">
             <h2 class="left-align">{{ company_name }}</h2>
             <p class="left-align">{{ address }}</p>
             <hr>
             <div class="text-center">
               <div class="left-section">
                 {% if selected_journal %}
                 <p>Notes:</p>
                 <p>{{ selected_journal.notes }}</p>
                 <p>Reference No: {{ selected_journal.reference_no }}</p>
               </div>
               <div class="right-section">
                 <p>Journal No: {{ selected_journal.journal_no }}</p>
                 <p>Date: {{ selected_journal.date }}</p>
                 <p>Amount: <i class="fa fa-inr"></i>{{ selected_journal.total_credit }}</p>
               </div>
             </div>        
             <hr>
             <div class="table-responsive">
               <table class="table">
                 <thead>
                   <tr>
                     <th>Account Name</th>
                     <th>Description</th>
                     <th>Contact</th>
                     <th>Debits</th>
                     <th>Credits</th>
                   </tr>
                 </thead>
                 <tbody>
                   {% for entry in journal_entries %}
                   <tr>
                     <td>{{ entry.account }}</td>
                     <td>{{ entry.description }}</td>
                     <td>{{ entry.contact }}</td>
                     <td>{{ entry.debits }}</td>
                     <td>{{ entry.credits }}</td>
                   </tr>
                   {% endfor %}
                 </tbody>
               </table>
             </div>
             <div class="text-center">
               <table class="table">
                 <tbody>
                   <tr>
                     <td>Total Debit:</td>
                     <td><i class="fa fa-inr"></i>{{ selected_journal.total_debit }}</td>
                   </tr>
                   <tr>
                     <td>Total Credit:</td>
                     <td><i class="fa fa-inr"></i>{{ selected_journal.total_credit }}</td>
                   </tr>
                   <tr>
                     <td>Difference:</td>
                     <td>{{ selected_journal.difference }}</td>
                   </tr>
                 </tbody>
               </table>
             </div>
           </div>
         </div>
         {% else %}
         <p>No journal selected.</p>
         {% endif %}
         <footer style="margin-top: 40px; width: 100%; height: auto; padding: 20px; background-color: #F5917C; color: #fff;" >
           <h5 class="text-center" style="font-size: 12px;">Â© Zoho Books 2023 | Info park kakkanad kochi, Ernamkulam, kerala India 12345 | Phone: (123) 456-7890 | Email: info@zohodjango.com</h5>
       </footer>
     </div>
     <br><br>
   </div>
 </section>
         `;
 
         return journalDetailsContent;
       }
 
     function loadJournalDetails(journalId) {
       var journalDetailsUrl = $('.list-item.active').data('journal-details-url');
       $('.details-section').html('<p>Loading journal details...</p>');
       $.ajax({
         url: journalDetailsUrl,
         method: 'GET',
         data: {
           journal_id: journalId
         },
         success: function(response) {
           $('.details-section').html(response);
           loadJournalComments(journalId);
         },
         error: function() {
           $('.details-section').html('<p>Failed to load journal details.</p>');
         }
       });
     }
 
     // Load details for the selected journal on page load, if available
     var selectedJournalId = sessionStorage.getItem('selectedJournalId');
     if (selectedJournalId) {
       loadJournalDetails(selectedJournalId);
       $('.list-item[data-journal-id="' + selectedJournalId + '"]').addClass('active');
     }
   });
 
   function convertToPDF() {
     const container = document.getElementById('container');
 
     const options = {
       filename: 'journal.pdf',
       image: { type: 'jpeg', quality: 0.98 },
       html2canvas: { scale: 2 },
       jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
     };
 
     html2pdf().from(container).set(options).save();
   }
 
   function confirmDelete() {
     if (confirm("Are you sure you want to delete this journal?")) {
       alert("Journal deleted successfully!");
     }
   }
   $(function () {
     $('[data-toggle="tooltip"]').tooltip();
   });
   function printJournal() {
   var printContents = document.getElementById('container').innerHTML;
   var originalContents = document.body.innerHTML;
 
   document.body.innerHTML = printContents;
   window.print();
 
   document.body.innerHTML = originalContents;
 }
 
 </script> -->